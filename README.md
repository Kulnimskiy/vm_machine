# Клиент-серверное приложение: Менеджер виртуальных машин

## Описание проекта

Проект представляет собой клиент-серверное приложение на сокетах (asyncio), предназначенное для 
управления виртуальными машинами (ВМ). Это консольное приложение включает в себя сервер и клиент, а его 
работа демонстрируется через несколько подключений клиентов к серверу.

При инициализации сервера автоматически создаются необходимые таблицы в базе данных.
Клиент при подключении получает доступ только к командам регистрации и аутентификации. 
После успешной аутентификации становятся доступны защищённые команды для управления учетом машинам на сервере.

## Функциональные возможности

### Виртуальная машина (клиент)

Каждая виртуальная машина обладает следующими характеристиками:

- **Уникальный идентификатор (ID)**
- **Объем выделенной RAM**
- **Количество выделенных CPU**
- **Объем памяти жесткого диска**
- **Уникальный идентификатор жесткого диска (ID)**
- **Дата и время регистрации**

### Сервер

Сервер выполняет следующие функции:

- Принимает подключения от клиентов (ВМ)
- Реализует аутентификацию клиентов
- Добавляет новые виртуальные машины в базу данных
- Выводит список всех подключенных виртуальных машин с их параметрами
- Выводит список всех авторизованных виртуальных машин с их параметрами
- Выводит список всех когда-либо подключаемых виртуальных машин с их параметрами
- Обрабатывает команду выхода из авторизованной ВМ
- Обновляет данные в авторизованной ВМ
- Выводит список всех жестких дисков с их параметрами, включая привязку к ВМ

## Технологии

- **Python** (asyncio, socket, asyncpg)
- **PostgreSQL** (для хранения информации о виртуальных машинах и жестких дисках)
- **Docker** (для развертывания базы данных и сервера)

## Установка и запуск

### 1. Клонирование репозитория

```sh
git clone <репозиторий>
cd <папка проекта>
```

### 2. Инициализация сервера и бд

```sh
make init 
```

### 2.1. Перезапуск сервера
```sh
make down up logs 
```

### 2.2. Отключение сервера
```sh
make down
```

### 3. Установка зависимостей локально

```sh
poetry install
```

### 4. Запуск сервера локально

```sh
python app/server.py
```

### 5. Запуск клиента (виртуальная машина)

```sh
python app/client.py
```


### Команды:
| Команда                | Описание                                      |
|------------------------|-----------------------------------------------|
| **ping**               | Проверяет связь с сервером                   |
| **register**           | Регистрирует новую ВМ с параметрами (RAM, CPU, диски) |
| **authenticate**       | Авторизует ВМ с ID и паролем                   |
| **list_active**        | Выводит список активных ВМ                    |
| **list_auth**          | Выводит список авторизованных ВМ             |
| **list_all**           | Выводит список всех ВМ                       |
| **list_all_disks**     | Выводит список всех жестких дисков           |
| **update_ram**         | Обновляет RAM ВМ                             |
| **update_ram_cpu_disks**| Обновляет RAM, CPU и диски ВМ               |
| **logout**             | Выходит из авторизованной ВМ                 |

## Примеры команд для работы с сервером

### ping
```json
{
    "command": "ping",
    "data": {}
}
```

### register
```json
{
    "command": "register",
    "data": {
        "vm_id": "stalin",
        "ram": 512,
        "cpu": 4,
        "password": "securePass123",
        "disks": [
            {
                "disk_size": 100
            },
            {
                "disk_size": 200
            }
        ]
    }
}
```

### authenticate
```json
{
    "command": "authenticate",
    "data": {
        "vm_id": "stalin",
        "password": "securePass123"
    }
}
```

### list_active
```json
{
    "command": "list",
    "data": {
        "token": "12345lkllnfsdanl",
        "list_type": "active_vms"
    }
}
```

### list_auth
```json
{
    "command": "list",
    "data": {
        "token": "12345lkllnfsdanl",
        "list_type": "authenticated_vms"
    }
}
```

### list_all
```json
{
    "command": "list",
    "data": {
        "token": "12345lkllnfsdanl",
        "list_type": "all_vms"
    }
}
```

### list_all_disks
```json
{
    "command": "list",
    "data": {
        "token": "12345lkllnfsdanl",
        "list_type": "all_disks"
    }
}
```

### update_ram
```json
{
    "command": "update",
    "data": {
        "token": "12345lkllnfsdanl",
        "ram": 1024
    }
}
```

### update_ram_cpu_disks
```json
{
    "command": "update",
    "data": {
        "token": "12345lkllnfsdanl",
        "ram": 2048,
        "cpu": 8,
        "disks": [
            {
                "id": 1,
                "disk_size": 150
            },
            {
                "id": 2,
                "disk_size": 250
            }
        ]
    }
}
```

### logout
```json
{
    "command": "logout",
    "data": {
      "token": "12345lkllnfsdanl"
    }
}
```

## Видео демонстрация
https://www.youtube.com/watch?v=brKDzYOtfjA


